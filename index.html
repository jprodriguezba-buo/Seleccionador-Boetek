<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de ACS</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
</head>
<body>
    <div class="header">
        <div class="logo-container">
            <img id="logobtk" src="./Images/Boetek PNG.png" alt="Logo Boetek">
            <span class="version-indicator">v 1.41</span>
        </div>
        <h1>Calculadora de ACS</h1>
    </div>
    <div class="main-container">
        <form id="calculadora-form">
            <h2>Definición de Demanda</h2>
            <div class="form-group">
                <label for="metodo-calculo">Método de Cálculo:</label>
                <select id="metodo-calculo">
                    <option value="departamentos" selected>Por Departamentos</option>
                    <option value="total_personas">Total de Personas</option>
                </select>
            </div>
            
            <div id="ingreso-departamentos-group">
                <table id="depto-table">
                    <thead>
                        <tr>
                            <th>Cant. De Dormitorios</th>
                            <th>Pers / depto</th>
                            <th>Unidades</th>
                            <th>Total Personas</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1 dormitorio</td>
                            <td>1,5</td>
                            <td><input type="number" id="unidades-1" min="0" value="0"></td>
                            <td class="total-personas-row" data-pers="1.5"></td>
                        </tr>
                        <tr>
                            <td>2 dormitorios</td>
                            <td>3</td>
                            <td><input type="number" id="unidades-2" min="0" value="0"></td>
                            <td class="total-personas-row" data-pers="3"></td>
                        </tr>
                        <tr>
                            <td>3 dormitorios</td>
                            <td>4</td>
                            <td><input type="number" id="unidades-3" min="0" value="0"></td>
                            <td class="total-personas-row" data-pers="4"></td>
                        </tr>
                        <tr>
                            <td>4 dormitorios</td>
                            <td>6</td>
                            <td><input type="number" id="unidades-4" min="0" value="0"></td>
                            <td class="total-personas-row" data-pers="6"></td>
                        </tr>
                        <tr>
                            <td>5 dormitorios</td>
                            <td>7</td>
                            <td><input type="number" id="unidades-5" min="0" value="0"></td>
                            <td class="total-personas-row" data-pers="7"></td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="2"><strong>Total:</strong></td>
                            <td id="total-unidades"></td>
                            <td id="total-personas-general"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <div id="ingreso-total-personas-group" style="display: none;">
                <table class="compact-table">
                    <tbody>
                        <tr>
                            <td>Total de Personas</td>
                            <td><input type="number" id="input-total-personas" min="0" value="100"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h2>Parámetros del Sistema</h2>
            <table class="compact-table" id="system-params-table">
                <tbody>
                    <tr>
                        <td>Tipo de Sistema</td>
                        <td>
                            <select id="tipo-sistema" required>
                                <option value="sala_calderas" selected>Sala de Calderas</option>
                                <option value="apoyo_re">Bomba de calor con apoyo de R.E.</option>
                                <option value="falla_re">Bomba de calor con RE en caso de falla</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Acumulación (Litros)</td>
                        <td><input type="number" id="acumulacion-ingresada" min="0" value="1000" required></td>
                    </tr>
                    <tr id="potencia-sala-calderas-group">
                        <td>Potencia Térmica (kW)</td>
                        <td><input type="number" id="potencia-ingresada" min="0" value="300" required></td>
                    </tr>
                    <tr id="potencia-bc-group" style="display:none;">
                        <td>Potencia Bombas de Calor (kW)</td>
                        <td><input type="number" id="potencia-bc" min="0" value="150"></td>
                    </tr>
                    <tr id="potencia-re-group" style="display:none;">
                        <td>Potencia Resistencias Eléctricas (kW)</td>
                        <td><input type="number" id="potencia-re" min="0" value="150"></td>
                    </tr>
                    <tr id="potencia-total-display-row" style="display:none;">
                        <td class="label-strong">Potencia Térmica Total</td>
                        <td class="value-strong"><span id="potencia-total-display">300</span> kW</td>
                    </tr>
                </tbody>
            </table>

            <div class="param-fijos">
                <div class="header">
                    <h2>Datos Fijos</h2>
                    <button type="button" id="edit-params-btn">Editar</button>
                </div>
                <div id="param-view-mode">
                    <table>
                        <tbody>
                            <tr><td>Guía de Demanda</td><td id="view-demanda-guia">Baja-Media</td></tr>
                            <tr><td>Prom. L/persona/día</td><td id="view-litros-persona-dia">60 L</td></tr>
                            <tr><td>Eficiencia</td><td id="view-eficiencia">90%</td></tr>
                            <tr><td>% uso acumulador</td><td id="view-uso-acumulador">80%</td></tr>
                            <tr><td>Temperatura agua fría</td><td id="view-temp-fria">10°C</td></tr>
                            <tr><td>Temperatura de acumulación</td><td id="view-temp-acumulacion">45°C</td></tr>
                            <tr><td>Temperatura de consumo</td><td id="view-temp-consumo">45°C</td></tr>
                            <tr class="fila-hora-punta"><td>Hora Punta Inicio</td><td id="view-hora-punta-inicio">19:00</td></tr>
                            <tr class="fila-hora-punta"><td>Hora Punta Fin</td><td id="view-hora-punta-fin">21:00</td></tr>
                        </tbody>
                    </table>
                </div>
                <div id="param-edit-mode" style="display:none;">
                     <table>
                        <tbody>
                            <tr>
                                <td>Guía de Demanda</td>
                                <td>
                                    <select id="demanda-guia" required>
                                        <option value="low">Baja</option>
                                        <option value="low-medium">Baja-Media</option>
                                        <option value="medium">Media</option>
                                        <option value="high">Alta</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>Prom. L/persona/día</td>
                                <td><input type="number" id="edit-litros-persona-dia" value="60" min="20" max="150"></td>
                            </tr>
                            <tr>
                                <td>Eficiencia</td>
                                <td><input type="number" id="edit-eficiencia" value="0.90" step="0.01" min="0.5" max="1.0"></td>
                            </tr>
                            <tr>
                                <td>% uso acumulador</td>
                                <td><input type="number" id="edit-uso-acumulador" value="0.80" step="0.01" min="0.1" max="1.0"></td>
                            </tr>
                            <tr>
                                <td>Temperatura agua fría</td>
                                <td><input type="number" id="edit-temp-fria" value="10" min="0" max="30"></td>
                            </tr>
                            <tr>
                                <td>Temperatura de acumulación</td>
                                <td><input type="number" id="edit-temp-acumulacion" value="45" min="45" max="80"></td>
                            </tr>
                            <tr>
                                <td>Temperatura de consumo</td>
                                <td><input type="number" id="edit-temp-consumo" value="45" min="40" max="60"></td>
                            </tr>
                            <tr class="fila-hora-punta">
                                <td>Hora Punta Inicio</td>
                                <td><input type="number" id="edit-hora-punta-inicio" value="19" min="0" max="23">:00</td>
                            </tr>
                            <tr class="fila-hora-punta">
                                <td>Hora Punta Fin</td>
                                <td><input type="number" id="edit-hora-punta-fin" value="21" min="0" max="23">:00</td>
                            </tr>
                        </tbody>
                    </table>
                    <button type="button" id="save-params-btn">Guardar</button>
                </div>
            </div>
        </form>

        <div class="resultados-wrapper" id="resultados">
            <div class="resultados-main">
                <h3>Resultados de la Comparación</h3>
                <table id="resultado-table">
                    <thead>
                        <tr>
                            <th title="Parámetro de consumo de agua caliente">Parámetro</th>
                            <th title="Volumen de agua requerido según la guía ASHRAE para el número de personas.">Requerido</th>
                            <th title="Capacidad del sistema seleccionado para proveer el volumen de agua.">Seleccionado</th>
                            <th title="Indica si el sistema seleccionado cumple con el requerimiento de ASHRAE.">Cumple</th>
                            <th class="boetek-col" title="Consumo de referencia medido por Boetek en proyectos similares.">Monitoreo</th>
                            <th class="sobre-dimensionamiento-col" title="Porcentaje en que el sistema seleccionado supera al consumo de monitoreo de Boetek.">Sobredimensionamiento</th>
                            <th class="col-falla" title="Capacidad del sistema operando solo con resistencias eléctricas (modo falla).">Seleccionado en falla</th>
                            <th class="col-falla" title="Indica si el sistema en modo falla cumple con el consumo de monitoreo de Boetek.">Cumple Falla</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>

            <div class="chart-section">
                <div class="chart-tabs">
                    <button id="tab-line" class="active">Perfil Diario (L/min)</button>
                    <button id="tab-bar">Consumo por Hora (L)</button>
                    <button id="tab-monthly">Consumo Mensual (m³)</button>
                </div>
                <div id="line-chart-container" class="chart-container">
                    <canvas id="lineChart"></canvas>
                </div>
                <div id="bar-chart-container" class="chart-container" style="display: none;">
                    <canvas id="barChart"></canvas>
                </div>
                <div id="monthly-chart-container" class="chart-container" style="display: none;">
                    <canvas id="monthlyChart"></canvas>
                </div>
            </div>

            <div class="info-boxes-wrapper">
                <div class="info-box" id="consumo-punta-box">
                    <h4>Horario Punta</h4>
                    <p>Consumo: <span id="consumo-punta-valor"></span> L</p>
                    <p>Generación: <span id="generacion-punta-valor"></span> L</p>
                </div>
                <div class="info-box" id="produccion-continua-box">
                    <h4>Caudales Instantáneos</h4>
                    <p>Caudal a 50°C: <span id="produccion-continua-50c"></span> L/min</p>
                    <p>Caudal a Temp. Consumo (<span id="prod-continua-temp">45</span>°C): <span id="produccion-continua-valor"></span> L/min</p>
                </div>
                <div class="info-box" id="consumo-anual-box">
                    <h4>Consumo Anual</h4>
                    <p><span id="consumo-anual-valor">0</span> m³</p>
                </div>
            </div>
        </div>
    </div>
    <script src="app.js"></script>
</body>
</html>