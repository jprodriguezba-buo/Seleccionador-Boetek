<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de ACS</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <link rel="icon" href="./Images/isotipo_Boetek.ico">
</head>
<body>
    <div class="header">
        <div class="logo-container">
            <img id="logobtk" src="./Images/Boetek PNG.png" alt="Logo Boetek">
            <span class="version-indicator">v 1.61</span>
        </div>
        <h1>Calculadora de ACS</h1>
    </div>
    <div class="main-container">
        
        <form id="calculadora-form" class="panel">
            <h2>Definición de Demanda</h2>
            <div class="form-group">
                <label for="metodo-calculo">Método de Cálculo:</label>
                <select id="metodo-calculo">
                    <option value="departamentos" selected>Por Departamentos</option>
                    <option value="total_personas">Total de Personas</option>
                </select>
            </div>
            
            <div id="ingreso-departamentos-group">
                <table id="depto-table">
                    <thead>
                        <tr>
                            <th>Cant. De Dormitorios</th>
                            <th>Pers / depto</th>
                            <th>Unidades</th>
                            <th>Total Personas</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1 dormitorio</td>
                            <td>1,5</td>
                            <td><input type="number" id="unidades-1" min="0" value="0"></td>
                            <td class="total-personas-row" data-pers="1.5"></td>
                        </tr>
                        <tr>
                            <td>2 dormitorios</td>
                            <td>3</td>
                            <td><input type="number" id="unidades-2" min="0" value="0"></td>
                            <td class="total-personas-row" data-pers="3"></td>
                        </tr>
                        <tr>
                            <td>3 dormitorios</td>
                            <td>4</td>
                            <td><input type="number" id="unidades-3" min="0" value="0"></td>
                            <td class="total-personas-row" data-pers="4"></td>
                        </tr>
                        <tr>
                            <td>4 dormitorios</td>
                            <td>6</td>
                            <td><input type="number" id="unidades-4" min="0" value="0"></td>
                            <td class="total-personas-row" data-pers="6"></td>
                        </tr>
                        <tr>
                            <td>5 dormitorios</td>
                            <td>7</td>
                            <td><input type="number" id="unidades-5" min="0" value="0"></td>
                            <td class="total-personas-row" data-pers="7"></td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="2"><strong>Total:</strong></td>
                            <td id="total-unidades"></td>
                            <td id="total-personas-general"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <div id="ingreso-total-personas-group" style="display: none;">
                <table class="compact-table">
                    <tbody>
                        <tr>
                            <td>Total de Personas</td>
                            <td><input type="number" id="input-total-personas" min="0" value="100"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h2>Parámetros del Sistema</h2>
            <table class="compact-table" id="system-params-table">
                <tbody>
                    <tr>
                        <td>Tipo de Sistema</td>
                        <td>
                            <select id="tipo-sistema" required>
                                <option value="sala_calderas" selected>Sala de Calderas</option>
                                <option value="apoyo_re">Bomba de calor con apoyo de R.E.</option>
                                <option value="falla_re">Bomba de calor con RE en caso de falla</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Acumulación (Litros)</td>
                        <td><input type="number" id="acumulacion-ingresada" min="0" value="1000" required></td>
                    </tr>
                    <tr id="potencia-sala-calderas-group">
                        <td>Potencia Térmica (kW)</td>
                        <td><input type="number" id="potencia-ingresada" min="0" value="300" required></td>
                    </tr>
                    <tr id="potencia-bc-group" style="display:none;">
                        <td>Potencia Bombas de Calor (kW)</td>
                        <td><input type="number" id="potencia-bc" min="0" value="150"></td>
                    </tr>
                    <tr id="potencia-re-group" style="display:none;">
                        <td>Potencia Resistencias Eléctricas (kW)</td>
                        <td><input type="number" id="potencia-re" min="0" value="150"></td>
                    </tr>
                    <tr id="potencia-total-display-row" style="display:none;">
                        <td class="label-strong">Potencia Térmica Total</td>
                        <td class="value-strong"><span id="potencia-total-display">300</span> kW</td>
                    </tr>
                </tbody>
            </table>

            <div class="param-fijos">
                <div class="header">
                    <h2>Datos Fijos</h2>
                    <button type="button" id="edit-params-btn">Editar</button>
                </div>
                <div id="param-view-mode">
                    <table>
                        <tbody>
                            <tr><td>Guía de Demanda</td><td id="view-demanda-guia">Low_Medium</td></tr>
                            <tr><td>Prom. L/persona/día</td><td id="view-litros-persona-dia">60 L</td></tr>
                            <tr><td>Eficiencia</td><td id="view-eficiencia">90%</td></tr>
                            <tr><td>% uso acumulador</td><td id="view-uso-acumulador">80%</td></tr>
                            <tr><td>Temperatura agua fría</td><td id="view-temp-fria">10°C</td></tr>
                            <tr><td>Temperatura de acumulación</td><td id="view-temp-acumulacion">45°C</td></tr>
                            <tr><td>Temperatura de consumo</td><td id="view-temp-consumo">45°C</td></tr>
                            <tr class="fila-hora-punta"><td>Hora Punta Inicio</td><td id="view-hora-punta-inicio">19:00</td></tr>
                            <tr class="fila-hora-punta"><td>Hora Punta Fin</td><td id="view-hora-punta-fin">21:00</td></tr>
                            <tr><td>Valor m³ Gas</td><td id="view-valor-gas">$1.250</td></tr>
                            <tr><td>Valor kWh Electricidad</td><td id="view-valor-kwh">$200</td></tr>
                        </tbody>
                    </table>
                </div>
                <div id="param-edit-mode" style="display:none;">
                     <table>
                        <tbody>
                            <tr>
                                <td>Guía de Demanda</td>
                                <td>
                                    <select id="demanda-guia" required>
                                        <option value="Low">Low</option>
                                        <option value="Low_Medium">Low_Medium</option>
                                        <option value="Medium">Medium</option>
                                        <option value="High">High</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>Prom. L/persona/día</td>
                                <td><input type="number" id="edit-litros-persona-dia" value="60" min="20" max="150"></td>
                            </tr>
                            <tr>
                                <td>Eficiencia</td>
                                <td><input type="number" id="edit-eficiencia" value="0.90" step="0.01" min="0.5" max="1.0"></td>
                            </tr>
                            <tr>
                                <td>% uso acumulador</td>
                                <td><input type="number" id="edit-uso-acumulador" value="0.80" step="0.01" min="0.1" max="1.0"></td>
                            </tr>
                            <tr>
                                <td>Temperatura agua fría</td>
                                <td><input type="number" id="edit-temp-fria" value="10" min="0" max="30"></td>
                            </tr>
                            <tr>
                                <td>Temperatura de acumulación</td>
                                <td><input type="number" id="edit-temp-acumulacion" value="45" min="45" max="80"></td>
                            </tr>
                            <tr>
                                <td>Temperatura de consumo</td>
                                <td><input type="number" id="edit-temp-consumo" value="45" min="40" max="60"></td>
                            </tr>
                            <tr class="fila-hora-punta">
                                <td>Hora Punta Inicio</td>
                                <td><input type="number" id="edit-hora-punta-inicio" value="19" min="0" max="23">:00</td>
                            </tr>
                            <tr class="fila-hora-punta">
                                <td>Hora Punta Fin</td>
                                <td><input type="number" id="edit-hora-punta-fin" value="21" min="0" max="23">:00</td>
                            </tr>
                             <tr>
                                <td>Valor m³ Gas</td>
                                <td><input type="number" id="edit-valor-gas" value="1250"></td>
                            </tr>
                            <tr>
                                <td>Valor kWh Electricidad</td>
                                <td><input type="number" id="edit-valor-kwh" value="200"></td>
                            </tr>
                        </tbody>
                    </table>
                    <button type="button" id="save-params-btn">Guardar</button>
                </div>
            </div>
        </form>

        <div class="resultados-wrapper" id="resultados">
            <div class="panel actions-panel">
    <button id="generar-reporte-btn">Generar Reporte PDF</button>
</div>
            <div class="resultados-main panel">
                <h3>Resultados de Selección</h3>
                <table id="resultado-table">
                    <thead>
                        <tr>
                            <th title="Parámetro de consumo de agua caliente">Parámetro</th>
                            <th title="Volumen de agua requerido según la guía ASHRAE para el número de personas.">Requerido</th>
                            <th title="Capacidad del sistema seleccionado para proveer el volumen de agua.">Seleccionado</th>
                            <th title="Indica si el sistema seleccionado cumple con el requerimiento de ASHRAE.">Cumple</th>
                            <th class="boetek-col" title="Consumo de referencia medido por Boetek en proyectos similares.">Monitoreo</th>
                            <th class="sobre-dimensionamiento-col" title="Porcentaje en que el sistema seleccionado supera al consumo de monitoreo de Boetek.">Sobredimensionamiento</th>
                            <th class="col-falla" title="Capacidad del sistema operando solo con resistencias eléctricas (modo falla).">Seleccionado en falla</th>
                            <th class="col-falla" title="Indica si el sistema en modo falla cumple con el consumo de monitoreo de Boetek.">Cumple Falla</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>
            <div class="cost-analysis-section panel">
                <h3>Análisis de Resultados</h3>
                <div class="chart-tabs">
                    <button id="tab-comparative" class="active">Tabla Comparativa</button>
                    <button id="tab-selection">Resultados Selección</button>
                    <button id="tab-peak-hours">Horario Punta</button>
                    <button id="tab-instant-flow">Caudales Instantáneos</button>
                </div>

                <div id="comparative-table-container">
                    <table id="comparative-costs-table">
                        <thead>
                            <tr>
                                <th>Parámetro</th>
                                <th>SCM (a Gas)</th>
                                <th>Bomba de Calor</th>
                                <th>Sistema Tradicional</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>M3 ACS anual</td>
                                <td id="comp-scm-anual-m3"></td>
                                <td id="comp-bc-anual-m3"></td>
                                <td id="comp-trad-anual-m3"></td>
                            </tr>
                            <tr>
                                <td>Prom M3 Dia</td>
                                <td id="comp-scm-diario-m3"></td>
                                <td id="comp-bc-diario-m3"></td>
                                <td id="comp-trad-diario-m3"></td>
                            </tr>
                            <tr>
                                <td>Ratio de generación</td>
                                <td id="comp-scm-ratio"></td>
                                <td id="comp-bc-ratio"></td>
                                <td id="comp-trad-ratio"></td>
                            </tr>
                            <tr>
                                <td>Valor m³ ACS</td>
                                <td id="comp-scm-costo-m3"></td>
                                <td id="comp-bc-costo-m3"></td>
                                <td id="comp-trad-costo-m3"></td>
                            </tr>
                            <tr>
                                <td>Costo Anual ACS</td>
                                <td id="comp-scm-costo-anual"></td>
                                <td id="comp-bc-costo-anual"></td>
                                <td id="comp-trad-costo-anual"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="selection-table-container" style="display: none;">
                    <table id="selection-costs-table">
                        <thead>
                            <tr>
                                <th>Parámetro</th>
                                <th id="selection-header"></th>
                            </tr>
                        </thead>
                        <tbody>
                             <tr>
                                <td>M3 ACS anual</td>
                                <td id="sel-anual-m3"></td>
                            </tr>
                            <tr>
                                <td>Prom M3 Dia</td>
                                <td id="sel-diario-m3"></td>
                            </tr>
                            <tr>
                                <td>Ratio de generación</td>
                                <td id="sel-ratio"></td>
                            </tr>
                            <tr>
                                <td>Valor m³ ACS</td>
                                <td id="sel-costo-m3"></td>
                            </tr>
                            <tr>
                                <td>Costo Anual ACS</td>
                                <td id="sel-costo-anual"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="peak-hours-container" style="display: none;">
                    <table id="peak-hours-table">
                        <thead>
                            <tr>
                                <th>Escenario de Suministro</th>
                                <th>Consumo Hora Punta</th>
                                <th>Cumple</th>
                                <th>Generación Hora Punta</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Suministro con BC al 100%</td>
                                <td class="consumo-punta-cell"></td>
                                <td id="validador-punta-100"></td>
                                <td id="gen-punta-100"></td>
                            </tr>
                            <tr>
                                <td>Suministro con BC al 75%</td>
                                <td class="consumo-punta-cell"></td>
                                <td id="validador-punta-75"></td>
                                <td id="gen-punta-75"></td>
                            </tr>
                             <tr>
                                <td>Suministro con BC al 50%</td>
                                <td class="consumo-punta-cell"></td>
                                <td id="validador-punta-50"></td>
                                <td id="gen-punta-50"></td>
                            </tr>
                             <tr>
                                <td>Suministro con BC al 25%</td>
                                <td class="consumo-punta-cell"></td>
                                <td id="validador-punta-25"></td>
                                <td id="gen-punta-25"></td>
                            </tr>
                            <tr>
                                <td>Suministro sin BC (solo acumulación)</td>
                                <td class="consumo-punta-cell"></td>
                                <td id="validador-punta-0"></td>
                                <td id="gen-punta-0"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="instant-flow-container" class="info-box-content" style="display: none;">
                    <h4>Caudales Instantáneos</h4>
                    <p>Caudal a 50°C: <span id="produccion-continua-50c"></span> L/min</p>
                    <p>Caudal a 60°C: <span id="produccion-continua-60c"></span> L/min</p>
                    <p>Caudal a Temp. Consumo (<span id="prod-continua-temp">45</span>°C): <span id="produccion-continua-valor"></span> L/min</p>
                </div>
            </div>
            <div class="chart-section panel">
                <div class="chart-tabs">
                    <button id="tab-line" class="active">Perfil Diario (L/min)</button>
                    <button id="tab-bar">Consumo por Hora (L)</button>
                    <button id="tab-monthly">Consumo Mensual (m³)</button>
                    <button id="tab-efficiency">Eficiencia</button>
                </div>
                <div id="line-chart-container" class="chart-container">
                    <canvas id="lineChart"></canvas>
                </div>
                <div id="bar-chart-container" class="chart-container" style="display: none;">
                    <canvas id="barChart"></canvas>
                </div>
                <div id="monthly-chart-container" class="chart-container" style="display: none;">
                    <canvas id="monthlyChart"></canvas>
                </div>
                <div id="efficiency-chart-container" class="chart-container" style="display: none;">
                    <canvas id="efficiencyChart"></canvas>
                </div>
            </div>


        </div>
    </div>

    <script src="reporte.js"></script>
    <script src="app.js"></script>
</body>
</html>